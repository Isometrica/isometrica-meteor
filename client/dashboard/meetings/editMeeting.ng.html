<div class="isometrica-meetings">
  <div class="isometrica-edit-modal isometrica-meetings-modal" id="isometrica-meetings-edit-modal">
    <div class="modal-content">
      <div class="modal-header clearfix">
        <div class="pull-left">
          <button type="button" class="btn btn-default" ng-click="vm.cancel()">
            Cancel
          </button>
        </div>
        <div class="pull-right">
          <button type="button" class="btn btn-primary" ng-disabled="!meetingForm.$valid"
                  ng-click="vm.save(meetingForm)">
            Save
          </button>
        </div>
        <h4 class="modal-title">Meeting record</h4>
      </div>
      <ng-form class="form-horizontal" name="meetingForm" schema="Meetings" schema-doc="vm.meeting">
        <div class="modal-body">

          <schema-form model="vm.meeting" fields="type,date,notes"
                       configure="vm.configureMeetingType(fields)"></schema-form>

          <div>
            <accordion>
              <accordion-group class="full-width">
                <accordion-heading>
                  <h4 class="panel-title pull-left">Attendees ({{vm.attendees.length}})</h4>
                  <i class="fa fa-chevron-right disclosure-indicator pull-right"></i>
                </accordion-heading>
                <accordion>
                  <accordion-group is-open="vm.attOpen[$index]" ng-repeat="att in vm.attendees track by $index">
                    <accordion-heading>
                      <span
                          ng-style="{'text-decoration': att.inTrash ? 'line-through' : 'inherit'}">{{att.person.fullName || '&nbsp;'}}</span>
                    </accordion-heading>
                    <ng-form class="form-horizontal" name="attForm" schema="Attendees" schema-doc="att">
                      <schema-form ng-if="!att.inTrash" model="att" fields="person,isRegular"></schema-form>
                      <hr ng-if="!att.inTrash">
                      <div class="form-group">
                        <div class="col-sm-8 col-sm-offset-4 clearfix">
                          <button ng-if="vm.meeting._id"
                                  type="button" class="btn btn-default pull-left"
                                  ng-click="vm.saveSubItem(attForm, vm.attOpen, $index)"
                                  ng-disabled="!attForm.$valid">
                            Save
                          </button>
                          <button type="button" class="btn btn-default pull-right"
                                  ng-click="vm.deleteAttendee($index)">
                            {{att.inTrash ? 'Restore' : 'Delete'}}
                          </button>
                        </div>
                      </div>
                    </ng-form>
                  </accordion-group>
                </accordion>
                <button type="button" class="btn btn-link btn-block btn-add" ng-click="vm.addAttendee()">Add attendee
                </button>
              </accordion-group>

              <accordion-group class="full-width">
                <accordion-heading>
                  <h4 class="panel-title pull-left">Agenda items ({{vm.agendaItems.length}})</h4>
                  <i class="fa fa-chevron-right disclosure-indicator pull-right"></i>
                </accordion-heading>
                <accordion>
                  <accordion-group is-open="vm.aiOpen[$index]" ng-repeat="agenda in vm.agendaItems track by $index">
                    <accordion-heading>
                      <div class="row">
                        <div class="col-xs-9" ng-style="vm.computeAgendaStyle(agenda)">
                          {{agenda.itemNo}}. {{agenda.details | firstLine}}
                        </div>
                        <div class="col-xs-1">
                          <i ng-if="agenda.comments && agenda.comments.length" class="fa fa-comment-o"></i>
                        </div>
                        <div class="col-xs-2 text-right" ng-style="vm.computeAgendaStyle(agenda)">
                          {{agenda.whoSubmitted.initials}}
                        </div>
                      </div>
                    </accordion-heading>
                    <ng-form class="form-horizontal" name="agendaForm" schema="AgendaItems" schema-doc="agenda">
                      <schema-form ng-if="!agenda.inTrash" model="agenda"
                                   fields="details,itemNo,whoSubmitted,isRegular,comments"></schema-form>
                      <hr ng-if="!agenda.inTrash">
                      <div class="form-group">
                        <div class="col-sm-8 col-sm-offset-4 clearfix">
                          <button ng-if="vm.meeting._id"
                                  type="button" class="btn btn-default pull-left"
                                  ng-click="vm.saveSubItem(agendaForm, vm.aiOpen, $index)"
                                  ng-disabled="!agendaForm.$valid">
                            Save
                          </button>
                          <button type="button" class="btn btn-default pull-right"
                                  ng-click="vm.deleteAgendaItem($index)">
                            {{agenda.inTrash ? 'Restore' : 'Delete'}}
                          </button>
                        </div>
                      </div>
                    </ng-form>
                  </accordion-group>
                </accordion>
                <button type="button" class="btn btn-link btn-block btn-add" ng-click="vm.addAgendaItem()">Add agenda
                  item
                </button>
              </accordion-group>

              <accordion-group class="full-width" ng-if="!vm.isNew">
                <accordion-heading>
                  <h4 class="panel-title pull-left">Action items from last meeting - closed ({{vm.prevActionItems.closed.length}}) </h4>
                  <i class="fa fa-chevron-right disclosure-indicator pull-right"></i>
                </accordion-heading>
                <accordion>
                  <accordion-group is-open="vm.maOpen.closed[$index]"
                                   ng-repeat="action in vm.prevActionItems.closed track by action._id">
                    <isa-meeting-action-card action="action" save="vm.saveSubItem(form, vm.maOpen.closed, $index)"></isa-meeting-action-card>
                  </accordion-group>
                </accordion>
              </accordion-group>

              <accordion-group class="full-width" ng-if="!vm.isNew">
                <accordion-heading>
                  <h4 class="panel-title pull-left">Action items from last meeting - open ({{vm.prevActionItems.open.length}})</h4>
                  <i class="fa fa-chevron-right disclosure-indicator pull-right"></i>
                </accordion-heading>
                <accordion>
                  <accordion-group is-open="vm.maOpen.open[$index]"
                                   ng-repeat="action in vm.prevActionItems.open track by action._id">
                    <isa-meeting-action-card action="action" save="vm.saveSubItem(form, vm.maOpen.open, $index)"></isa-meeting-action-card>
                  </accordion-group>
                </accordion>
              </accordion-group>

              <accordion-group class="full-width" ng-if="!vm.isNew">
                <accordion-heading>
                  <h4 class="panel-title pull-left">New meeting actions ({{vm.actionItems.length}})</h4>
                  <i class="fa fa-chevron-right disclosure-indicator pull-right"></i>
                </accordion-heading>
                <accordion>
                  <accordion-group is-open="vm.maOpen.added[$index]" ng-repeat="action in vm.actionItems track by $index">
                    <isa-meeting-action-card action="action"
                                             agenda-items="vm.agendaItems"
                                             save="vm.saveSubItem(form, vm.maOpen.added, $index)">
                    </isa-meeting-action-card>
                  </accordion-group>
                </accordion>
                <div class="text-center">
                  <button type="button" class="btn btn-link btn-add" ng-click="vm.addMeetingAction()">Add new action
                  </button>
                </div>
              </accordion-group>
            </accordion>
          </div>
          <div ng-if="!vm.isNew" class="text-center">
            <button type="button" class="btn btn-default btn-delete" ng-click="vm.delete()">Delete</button>
          </div>
        </div>

        <div ng-if="!vm.isNew" class="modal-footer">
          <div class="row">
            <div class="col-xs-6">
              <div class="text-left"><small>Recorded by: {{vm.meeting.created.fullName}}</small></div>
              <div class="text-left"><small>Date: {{vm.meeting.created.at | isaDate}}</small></div>
            </div>
            <div class="col-xs-6">
              <div class="text-right"><small>Last edited by: {{vm.meeting.modified.fullName}}</small></div>
              <div class="text-right"><small>Date: {{vm.meeting.modified.at | isaDate}}</small></div>
            </div>
          </div>
        </div>
      </ng-form>

    </div>
  </div>
</div>
