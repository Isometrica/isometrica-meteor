
<isa-address-book-modal-header
	can-save="userForm.$valid"
	on-save="save()"
	on-cancel="cancel()"
	title="{{ isNew ? 'New' : 'Edit' }} User">
</isa-address-book-modal-header>

<div class="modal-body">

	<div class="form-group has-error text-center">
		<small class="help-block" ng-show="err">{{ err.message }}</small>
	</div>

	<form
		novalidate
		name="userForm"
		schema="UserEdit"
		class="form-horizontal"
		schema-doc="object.profile">
		<isa-access isa-loading="loading" isa-superpowers="{ canEditUserProfiles: !isNew && !isCurrentUser() }">
			<schema-form model="object.profile" fields="photo,firstName,lastName,initials,title,role"></schema-form>
			<schema-form model="object" fields="email"></schema-form>
			<isa-phone-numbers contactable ="object.profile"></isa-phone-numbers>
			<schema-form model="object.profile" fields="address"></schema-form>
			<schema-form ng-if="isNew" model="object" fields="password"></schema-form>
			<div class="form-group" ng-if="!isNew">
				<label class="control-label col-xs-4">Password</label>
				<div class="col-xs-8">
					<button type="button" class="btn btn-primary" ng-click="changePassword()">Change password</button>
				</div>
			</div>
		</isa-access>
	</form>

	<div>

		<form
			novalidate
			name="memForm"
			schema="Membership"
			class="form-horizontal panel panel-default bootcards-panel-collapsing full-width"
			schema-doc="membership">
	    <div class="panel-heading clearfix collapsed" href="#superpowers" data-toggle="collapse">
	      <i class="fa fa-chevron-circle-down bootcards-panel-collapsing-indicator"></i>
				<h4 class="panel-title pull-left">{{ object.profile.firstName || "User" }}'s superpowers for {{ $root.currentOrg.name }}</h4>
	      <i class="fa fa-chevron-right disclosure-indicator pull-right"></i>
	    </div>
	    <div class="collapse" id="superpowers">
	      <div class="panel-body">
					<isa-access isa-loading="loading" isa-superpowers="{ canEditUserSuperpowers: !isNew }">
						<schema-form model="membership" fields="canCreateUsers,canCreateDocuments,canEditOrgSettings,canViewAllWorkInboxes,canEditUserProfiles,canEditUserSuperpowers,canDeleteOrganisation,canCreateEditDashboard"></schema-form>
					</isa-access>
	      </div>
	    </div>
		</form>

		<div ng-if="!isNew" class="panel panel-default bootcards-panel-collapsing full-width">
	    <div class="panel-heading clearfix collapsed" href="#documents" data-toggle="collapse">
	      <i class="fa fa-chevron-circle-down bootcards-panel-collapsing-indicator"></i>
	      <h4 class="panel-title pull-left">Documents {{ object.profile.firstName }} can access</h4>
	      <i class="fa fa-chevron-right disclosure-indicator pull-right"></i>
	    </div>
			<div class="collapse" id="documents">
				<div class="table-responsive">
					<table class="table">
						<thead>
							<tr>
								<th>Document title</th>
								<th>Access privileges</th>
								<th>Owner</th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="doc in docs">
								<td>{{ doc.title }}</td>
								<td>{{ doc.permission }}</td>
								<td>{{ doc.owner.fullName }}</td>
							</tr>
						</tbody>
					</table>
				</div>
	    </div>
		</div>

    <div class="panel panel-default bootcards-panel-collapsing full-width" ng-if="!isNew">
      <div class="collapse" id="delete">
        <div class="table-responsive">
          <table class="table">
            <tbody>
              <tr ng-repeat="group in memberships | group: 3">
                <td ng-repeat="mem in group" class="col-sm-3" ng-init="user = mem.user()">
                  <button
                    type="button"
                    class="btn"
                    ng-disabled="user._id === object._id"
                    ng-click="setDstId(mem._id)"
                    ng-class="dstMemId === mem._id ? 'btn-primary' : 'btn-default'">
                    <p class="list-group-item-text">{{ user.profile.fullName }}</p>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

	</div>

  <div class="text-center panel-heading clearfix collapsed" ng-if="!isNew" isa-access isa-superpowers="[ 'canCreateUsers' ]">
    <button type="button" class="btn btn-default" href="#delete" data-toggle="collapse" ng-click="handleDelete()">
      {{ deleteButtonTitle() }}
    </button>
  </div>

</div>
